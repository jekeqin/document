# 消息队列

## 主流消息队列对比

<style>
td,th{font-size:13px;}
table th:first-child{width:80px;}
table tr th:nth-child(2){width:200px;}
table tr th:nth-child(3){width:200px;}
table tr th:nth-child(4){width:200px;}
table tr th:nth-child(5){width:200px;}
</style>
<table>
    <tr>
        <th></th>
        <th>RabbitMQ</th>
        <th>ActiveMQ</th>
        <th>RocketMQ</th>
        <th>Kafka</th>
    </tr>
    <tr>
        <td>公司/社区</td>
        <td>Mozilla Public License</td>
        <td>Apache</td>
        <td>Ali</td>
        <td>Apache</td>
    </tr>
    <tr>
        <td>成熟度</td>
        <td>成熟</td>
        <td>成熟</td>
        <td>比较成熟</td>
        <td>成熟</td>
    </tr>
    <tr>
        <td>授权方式</td>
        <td>开源</td>
        <td>开源</td>
        <td>开源</td>
        <td>开源</td>
    </tr>
    <tr>
        <td>开发语言</td>
        <td>Erlang</td>
        <td>Java</td>
        <td>Java</td>
        <td>Scala&Java</td>
    </tr>
    <tr>
        <td>客户端支持语言</td>
        <td>官方支持Erlang,Java,Ruby等，社区产出多种语言API，几乎支持所有常用语言</td>
        <td>Java,C,C++,Python,PHP,Perl,.net等</td>
        <td>Java,C++(不成熟)</td>
        <td>官方支持Java，开源社区有多语言版本，如PHP,Go,C/C++,Ruby,Node.js等编程语言，祥见Kafka客户端列表</td>
    </tr>
    <tr>
        <td>协议支持</td>
        <td>多协议支持：AMQP,XMPP,SMTP,STOMP</td>
        <td>OpenWire,STOMP,REST,XMPP,AMQP</td>
        <td>自己定义的一套(社区提供JMS，不成熟)</td>
        <td>自有协议，社区封装了HTTP协议支持</td>
    </tr>
    <tr>
        <td>消息批量操作</td>
        <td>不支持</td>
        <td>支持</td>
        <td>支持</td>
        <td>支持</td>
    </tr>
    <tr>
        <td>消息推拉模式</td>
        <td>多协议，Pull/Push均有支持</td>
        <td>多协议，Pull/Push均有支持</td>
        <td>多协议，Pull/Push均有支持</td>
        <td>Pull</td>
    </tr>
    <tr>
        <td>HA</td>
        <td>master/slave模式，master提供服务，slave仅作备份</td>
        <td>基于ZooKeeper + LevelDB 的Master-Slave实现模式</td>
        <td>支持Master模式、多Master多Slave模式、异步复制模式、同步双写</td>
        <td>支持replica机制，leader宕掉后，备份自动顶替，并重新选举leader(基于ZooKeeper)</td>
    </tr>
    <tr>
        <td>数据可靠性</td>
        <td>可保证数据不丢失，有slave用作备份</td>
        <td>master/slave</td>
        <td>支持异步实时刷盘，同步刷盘，同步复制，异步复制</td>
        <td>数据可靠，并且有relica机制，有容错容灾能力</td>
    </tr>
    <tr>
        <td>单机吞吐量</td>
        <td>其次(万级)</td>
        <td>最差(万级)</td>
        <td>最高(十万级)</td>
        <td>次之(十万级)</td>
    </tr>
    <tr>
        <td>消息延迟</td>
        <td>微秒级</td>
        <td>/</td>
        <td>比kafka快</td>
        <td>毫秒级</td>
    </tr>
    <tr>
        <td>持久化能力</td>
        <td>内存、文件，支持数据堆叠，但数据堆叠反过来影响生成速率</td>
        <td>内存、文件、数据库</td>
        <td>磁盘文件</td>
        <td>磁盘文件，只要磁盘容量够，可做到无限消息堆积</td>
    </tr>
    <tr>
        <td>是否有序</td>
        <td>若想有序，只能使用一个Client</td>
        <td>可以支持有序</td>
        <td>有序</td>
        <td>多Client保证有序</td>
    </tr>
    <tr>
        <td>事务</td>
        <td>不支持</td>
        <td>支持</td>
        <td>支持</td>
        <td>不支持，但可以通过Low Level API保证仅消费一次</td>
    </tr>
    <tr>
        <td>集群</td>
        <td>支持</td>
        <td>支持</td>
        <td>支持</td>
        <td>支持</td>
    </tr>
    <tr>
        <td>负载均衡</td>
        <td>支持</td>
        <td>支持</td>
        <td>支持</td>
        <td>支持</td>
    </tr>
    <tr>
        <td>管理界面</td>
        <td>较好</td>
        <td>一般</td>
        <td>命令行界面</td>
        <td>官方只提供了命令行版，Yahoo开源自己的KafkaWeb管理界面Kafka-Manager</td>
    </tr>
    <tr>
        <td>部署方式</td>
        <td>独立</td>
        <td>独立</td>
        <td>独立</td>
        <td>独立</td>
    </tr>
</table>

## 横向对比

特性|ActiveMQ|RabbitMQ|RocketMQ|Kafka
:---|:---|:---|:---|:---
PRODUCER-COMSUMER|支持|支持|支持|支持
PUBLISH-SUBSCRIBE|支持|支持|支持|支持
REQUEST-REPLY|支持|支持|-|支持
API完备性|高|高|高|低（静态配置）
多语言支持|支持，JAVA优先|语言无关|支持，JAVA优先|支持
单机呑吐量|万级|万级|十万级|单机万级
消息延迟|-|微秒级|毫秒级|-
可用性|高（主从）|高（主从）|非常高（分布式）|高
消息丢失|-|低|理论上不会丢失|-
消息重复|-|可控制|理论上会有重复|-
文档的完备性|高|高|高|中
提供快速入门|有|有|有|无
首次部署难度|低|低|中|高